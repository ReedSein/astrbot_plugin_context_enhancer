# 更新日志

本文档记录了 AstrBot 上下文增强器的所有重要更改。

## [2.0.0] - 2025-01-15

### ✨ 新增功能
- 🎯 **全新的信息层次结构** - 按重要性和相关性组织上下文信息
  1. 当前群聊状态 - 群聊氛围、活跃用户、话题分析
  2. 最近群聊内容 - 普通消息背景信息
  3. 与你相关的对话 - 触发 AI 回复的重要对话
  4. 最近图片信息 - 视觉上下文补充
  5. 当前请求详情 - 详细的请求信息和触发方式

- 🎭 **角色扮演支持** - 通过 `bot_self_reference` 配置支持各种人设
- 🤖 **机器人回复收集** - 智能收集机器人的回复，补充数据库记录不足
- 📊 **一问一答对话整理** - 智能匹配用户触发和机器人回复
- 🎨 **交互图标** - 使用 👤🤖📷 等图标增强可读性
- 🔍 **详细调试信息** - 完善的日志系统便于问题诊断

### 🔧 技术改进
- 🛡️ **系统安全性** - 不影响 `system_prompt`，完全兼容人设系统
- 🔗 **插件兼容性** - 使用 `priority=100`，不干扰其他插件
- ⚡ **性能优化** - 使用 `deque` 管理内存，异步处理避免阻塞
- 🔄 **数据库整合** - 结合数据库记录和内存缓存提供完整上下文

### 📝 配置更新
- 新增 `bot_self_reference` - 机器人自称配置
- 新增 `collect_bot_replies` - 是否收集机器人回复
- 新增 `max_bot_replies` - 机器人回复收集数量
- 新增 `detailed_current_request` - 详细当前请求信息
- 新增 `show_interaction_icons` - 显示交互图标

### 📚 文档完善
- 📖 **完整的 README** - 详细的功能介绍和使用指南
- 🎯 **配置说明** - 所有配置项的详细说明和示例
- 🛠️ **技术文档** - 架构设计和实现原理说明
- 🤝 **贡献指南** - 开发者贡献指南

## [1.0.0] - 2024-12-XX

### ✨ 初始版本
- 🚀 **基础上下文增强功能**
- 📊 **多维度消息收集**
- 🎯 **智能触发消息识别**
- 📷 **图片消息处理**
- ⚙️ **基础配置系统**

---

## 版本说明

本项目遵循 [语义化版本](https://semver.org/lang/zh-CN/) 规范。

- **MAJOR（主版本号）**: 当进行不兼容的 API 修改时
- **MINOR（次版本号）**: 当添加向后兼容的新功能时
- **PATCH（修订版本号）**: 当进行向后兼容的缺陷修复时

## 符号说明

- ✨ 新增功能
- 🔧 改进优化
- 🐛 问题修复
- 📚 文档更新
- 🎨 界面改进
- ⚡ 性能优化
- 🛡️ 安全更新
- 🔗 依赖更新
