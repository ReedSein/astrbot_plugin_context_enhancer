# Context Enhancer Plugin - 成品插件

这个插件已经完成并可以使用了！

## 插件功能

✅ **静默运行** - 插件不会主动回复任何消息，只增强上下文
✅ **深度解析** - 将消息链中的图片、回复、At等元素转换为LLM易于理解的文本描述  
✅ **无缝增强** - 自动替换即将送入LLM的提示词，所有依赖LLM的插件都能受益
✅ **兼容性强** - 不会干扰其他插件的正常运行
✅ **可配置** - 支持在AstrBot后台进行详细配置

## 文件结构

```
astrbot_plugin_context_enhancer/
├── main.py                    # 插件主入口，包含核心逻辑
├── metadata.yaml              # 插件元数据
├── _conf_schema.json          # 配置项定义  
├── README.md                  # 说明文档
└── utils/                     # 工具类目录
    ├── __init__.py            # 初始化文件
    ├── image_caption.py       # 图片转述工具
    └── message_utils.py       # 消息处理工具
```

## 核心技术要点

1. **`@filter.on_llm_request(priority=1)`** - 通过高优先级钩子函数，在所有LLM请求前进行拦截和增强
2. **历史记录解析** - 智能解析 AstrBot 的对话历史，转换为可处理的消息对象
3. **消息链增强** - 将复杂的消息结构（图片、回复、@等）转换为丰富的文本描述
4. **图片内容转述** - 调用多模态LLM将图片内容转换为文字描述
5. **兼容性设计** - 通过配置项控制生效范围，不影响原有功能

## 使用方法

1. 将插件文件夹复制到 `data/plugins/` 目录下
2. 在AstrBot后台启用插件
3. 根据需要调整配置（如启用的群聊、图片转述等）
4. 插件将自动为所有LLM请求提供增强的上下文信息

## 效果对比

- **使用前**: LLM只能看到简单的文本消息
- **使用后**: LLM能够理解图片内容、回复关系、@对象等复杂信息，提供更准确、更贴切的回复

这正是您希望实现的"让机器人变聪明"的效果！
